
<html>
<head>
    <meta charset="utf-8">
    <title>onbeforeunloadd</title>
</head>
<body>

    请关闭本网页！
    <script>
        /*
    *author:ls
    *email:liusaint@gmail.com
    * data:2016/03/20
    */

    window.onload = function(e) {
        if (localStorage.getItem('beforeloadResult')) {
            alert(localStorage.getItem('beforeloadResult'))
            localStorage.removeItem('beforeloadResult')
        }
    }
    window.onbeforeunload = function(e) {
        e = e || window.event
        // 兼容IE8和Firefox 4之前的版本
        if (e) {
          e.returnValue = '关闭提示'
        }
        // 清除localStorage
        if (localStorage.getItem('beforeloadResult')) {
            localStorage.removeItem('beforeloadResult')
        }
        // 火狐浏览器BUG
        setTimeout(function() {
        setTimeout(beforeloadResult, 50)
      }, 50)
        return '确认离开网页？'
    }
    function beforeloadResult () {
        localStorage.setItem('beforeloadResult', true)
        console.log(true)
        alert("你取消了离开网页！")
    }

</script>
</body>
</html>